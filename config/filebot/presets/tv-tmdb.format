/data/media/shows/{n}{(y && !(n =~ /(?i)\b${y}\b/)) ? " (${y})" : ""} {'{tmdb-' + tmdbid + '}'} / {"Season " + s.pad(2) + ((S && !(S ==~ /(?i)\s*\d+\s*$/)) ? " - " + S : "")} / { def ytag=(y && !(n =~ /(?i)\b${y}\b/)) ? " (${y})" : ""; def name=[ n + ytag, episodes ? episodes*.format('S%02dE%02d').join('-') : s00e00, (t ?: null) ].findAll{ it }.join(' - '); name }{ def srcRaw=(source?:''); def src=srcRaw.toUpperCase().replaceAll(/\s+|[^A-Z0-9]+/,'').replaceAll(/(2160|1080|720|480|360)P?/,''); def resDigits=(vf?:'').replaceAll(/[^0-9]/,''); def res=resDigits?resDigits+'P':''; def aud=(ac?:'').toUpperCase().replaceAll(/\s+|[^A-Z0-9]+/,''); def tag=((fn+' '+srcRaw).toUpperCase().find(/AMZN|AMAZON|DSNP|DISNEY|NF|NETFLIX|HMAX|MAX|HBO|APPLE ?TV\+?|ATV\+?|HULU|PARAMOUNT|PMTP|PEACOCK/)?:''); def prov= tag.matches(/AMZN|AMAZON/)?'AMZN': tag.matches(/DSNP|DISNEY/)?'DSNP': tag.matches(/NF|NETFLIX/)?'NF': tag.matches(/HMAX|MAX|HBO/)?'HMAX': tag.matches(/APPLE ?TV\+?|ATV\+?/)?'ATV': tag.matches(/PARAMOUNT|PMTP/)?'PARA': tag.matches(/HULU/)?'HULU': tag.matches(/PEACOCK/)?'PEACOCK':''; def ch = any{ channels }{ null }; def badge=[res,src,[aud,ch].findAll{it}.join(''),prov].findAll{it}.join('-'); badge?" [${badge}]":"" }
