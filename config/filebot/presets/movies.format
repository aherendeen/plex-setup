/data/media/movies/{n} ({y}) {'{tmdb-'+tmdbid+'}'/{ def base = n + ' ('+y+')'; def ed = fn.matchAll(/(?i)extended|uncensored|remastered|unrated|uncut|director'?s?.cut|special.edition|redux|imax/)*.upperInitial()*.lowerTrail().unique().join(', '); def srcRaw=(source?:''); def src=srcRaw.toUpperCase().replaceAll(/\s+|[^A-Z0-9]+/,'').replaceAll(/(2160|1080|720|480|360)P?/,''); def res=(vf?:'').replaceAll(/[^0-9]/,''); res = res ? res+'P' : ''; def aud=(ac?:'').toUpperCase().replaceAll(/\s+|[^A-Z0-9]+/,''); def ch = any{ channels }{ null }; def prov=((fn+' '+srcRaw).toUpperCase().find(/AMZN|AMAZON|DSNP|DISNEY|NF|NETFLIX|HMAX|MAX|HBO|APPLE ?TV\+?|ATV\+?|HULU|PARAMOUNT|PMTP|PEACOCK/)?:''); def p= prov.matches(/AMZN|AMAZON/)?'AMZN': prov.matches(/DSNP|DISNEY/)?'DSNP': prov.matches(/NF|NETFLIX/)?'NF': prov.matches(/HMAX|MAX|HBO/)?'HMAX': prov.matches(/APPLE ?TV\+?|ATV\+?/)?'ATV': prov.matches(/PARAMOUNT|PMTP/)?'PARA': prov.matches(/HULU/)?'HULU': prov.matches(/PEACOCK/)?'PEACOCK':''; def badge=[res,src,[aud,ch].findAll{it}.join(''),p].findAll{it}.join('-'); [ base, ed? '('+ed+')':null, '{tmdb-'+tmdbid+'}', badge? '['+badge+']':null ].findAll{it}.join(' ') }
